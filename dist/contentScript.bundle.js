(()=>{"use strict";const e={HOME:"home",PLAYLIST:"playlist",PLAYER:"player",CHANNEL_INDEX:"channel-index"},t={[e.PLAYER]:"/watch",[e.PLAYLIST]:"/playlist",[e.CHANNEL_INDEX]:"/@",[e.HOME]:"/"},a={[e.PLAYER]:"#related",[e.HOME]:'.ytd-browse[page-subtype="home"] #contents',[e.CHANNEL_INDEX]:'.ytd-browse[page-subtype="channels"] #contents',[e.PLAYLIST]:'.ytd-browse[page-subtype="playlist"] #contents'},n=e=>a[e],o=1,s=2,r=4,c={[o]:console.log,[s]:console.warn,[r]:console.error},i=async(...e)=>await(async(e,...t)=>{if(await E())return c[e]("[Hide Members Only Videos]",...t)})(1,...e),l="settings",d="enabledLocations",y="statsEnabled",w="debugLogsEnabled",u="excludedChannelNames",f=()=>browser.storage.local,m=async()=>(await f().get(l))[l]||{},b=e=>!0===e||!1===e,L=async()=>(await m())[d],E=async()=>!0===await(async()=>(await m())[w]||!1)(),h=async()=>{const t=await m();return(t=>{return t&&(t=>{if(!Array.isArray(t))return!1;for(const a of t)if(!Object.values(e).includes(a))return!1;return!0})(t[d])&&(n=t[y],b(n))&&(a=t[w],b(a));var a,n})(t)?t:(await(async()=>{const t={[l]:{[d]:[e.PLAYER,e.PLAYLIST,e.CHANNEL_INDEX,e.HOME],[y]:!0,[w]:!1,[u]:[]}};return await f().set(t),t})(),await m())},g=()=>browser.storage.local,N=async(e,t)=>{const a=await(async e=>(await g().get(e))[e]||{})(e),n=a[t]||0,o={[e]:{...a,[t]:n+1}};g().set(o)},A=async e=>N("locationHideCounts",e),p=async e=>N("hideCounts",e),v=e=>e?.textContent?.trim(),C=["ytd-rich-item-renderer","yt-lockup-view-model","ytd-playlist-video-renderer"],S=new Map,M=async(a,n)=>{if(!(e=>Array.from(e.querySelectorAll(".yt-badge-shape__text")).some(e=>e.textContent.toLowerCase().includes("Members only".toLowerCase())))(a))return;const o=await(a=>{switch((()=>{for(const[e,a]of Object.entries(t))if(window.location.pathname.startsWith(a))return e;return null})()){case e.PLAYER:case e.HOME:{const e=a.querySelector("yt-content-metadata-view-model span.yt-content-metadata-view-model__metadata-text");return v(e)}case e.CHANNEL_INDEX:{const e=document.getElementById("page-header"),t=e?.querySelector(".dynamicTextViewModelH1 span.yt-core-attributed-string");return v(t)}case e.PLAYLIST:{const e=a.querySelector(".ytd-channel-name a");return v(e)}default:return null}})(a)||"Unknown";if(!await(async e=>{const t=(await(async()=>(await m())[u]||[])()).map(e=>e.toLowerCase()).includes(e.toLowerCase());return t&&await i(`Channel name "${e}" is excluded from statistics, not incrementing hide counts.`),t})(o)){await i(`Removing members only video from ${n} by channel ${o}`);try{await(async(e,t)=>{g()&&(await(async()=>!0===await(async()=>(await m())[y]||!0)())()?await Promise.all([p(e),A(t)]):console.warn("Statistics are disabled, not incrementing hide counts."))})(o,n)}catch(e){console.error("Failed to increment hide count:",e)}a.remove()}},H=async(e,t)=>{for(const a of C){const n=e.matches(a)?[e]:e.querySelectorAll&&e.querySelectorAll(a);for(const e of n)await M(e,t)}},O=async e=>{const t=await P();if(0!==t.length)for(const a of e){const e=Array.from(a.addedNodes);if(e.length)for(const a of e)if(a.nodeType===Node.ELEMENT_NODE)for(const e of t){const o=n(e),s=a.matches(o)||a.querySelector(o);s&&(await I(s,e),t.splice(t.indexOf(e),1))}}},P=async()=>{const e=await L(),t=Array.from(S.keys()).map(e=>S.get(e).location);return e.filter(e=>!t.includes(e))},I=async(e,t)=>{if(!e?.isConnected)return void await i("No container found for location",t);const a=new MutationObserver(async(a,n)=>{if(!e.isConnected)return await i("Disconnecting observer for location",t),n.disconnect(),void S.delete(e);await(async(e,t)=>{for(const a of e){const e=Array.from(a.addedNodes).filter(e=>e.nodeType===Node.ELEMENT_NODE);for(const a of e)await H(a,t)}})(a,t)});a.observe(e,{childList:!0,subtree:!0}),S.set(e,{observer:a,location:t}),await(async(e,t)=>{for(const a of C)for(const n of e.querySelectorAll(a))await M(n,t)})(e,t),await i("Bound observer for location",t)},_=async e=>{const t=n(e),a=document.querySelector(t);await I(a,e)};browser.runtime.onMessage.addListener(async e=>{e.enabledLocations?.length&&await(async e=>{const t=e.map(async e=>(await i("Starting to observe",e),await _(e),e));await Promise.all(t)})(e.enabledLocations),e.disabledLocations?.length&&await(async e=>{for(const[t,a]of S)e.includes(a.location)&&(a.observer.disconnect(),S.delete(t),await i("Disconnected observer for",a.location))})(e.disabledLocations)});(async()=>{await(async()=>{await h(),await(async()=>{const e=await L();if(e.length)for(const t of e)await _(t);else await i("No locations to hide are enabled.")})(),await(async()=>{const e=new MutationObserver(O),t=document.body.querySelector("#content");e.observe(t,{childList:!0,subtree:!0})})()})()})()})();