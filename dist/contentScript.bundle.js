(()=>{"use strict";const e={HOME:"home",PLAYLIST:"playlist",PLAYER:"player",CHANNEL_INDEX:"channel-index"},t={[e.PLAYER]:"/watch",[e.PLAYLIST]:"/playlist",[e.CHANNEL_INDEX]:"/@",[e.HOME]:"/"},o={[e.PLAYER]:"#related",[e.HOME]:'.ytd-browse[page-subtype="home"] #contents',[e.CHANNEL_INDEX]:'.ytd-browse[page-subtype="channels"] #contents',[e.PLAYLIST]:'.ytd-browse[page-subtype="playlist"] #contents'},n=e=>o[e],a="settings",r="enabledLocations",s="statsEnabled",c=async()=>(await browser.storage.local.get(a))[a]||null,i=async()=>(await c())[r],l=async()=>{const t=await c();return(t=>{return t&&(t=>{if(!Array.isArray(t))return!1;for(const o of t)if(!Object.values(e).includes(o))return!1;return!0})(t[r])&&(!0===(o=t[s])||!1===o);var o})(t)?t:(await(async()=>{const t={[a]:{[r]:[e.PLAYER,e.PLAYLIST,e.CHANNEL_INDEX,e.HOME],[s]:!0}};return await(browser.storage?.local?.set(t)),t})(),await c())},d="hideCounts",y=async(e,t)=>{const o=await(async e=>(await e.get(d))[d]||{})(e),n=o[t]||0,a={[d]:{...o,[t]:n+1}};await e.set(a)},w=e=>e?.textContent?.trim(),u=["ytd-rich-item-renderer","yt-lockup-view-model","ytd-playlist-video-renderer"],f=new Map,b=async(o,n)=>{if((e=>Array.from(e.querySelectorAll(".yt-badge-shape__text")).some(e=>e.textContent.toLowerCase().includes("Members only".toLowerCase())))(o)){const n=await(o=>{switch((()=>{for(const[e,o]of Object.entries(t))if(window.location.pathname.startsWith(o))return e;return null})()){case e.PLAYER:case e.HOME:{const e=o.querySelector("yt-content-metadata-view-model span.yt-content-metadata-view-model__metadata-text");return w(e)}case e.CHANNEL_INDEX:{const e=document.getElementById("page-header"),t=e?.querySelector(".dynamicTextViewModelH1 span.yt-core-attributed-string");return w(t)}case e.PLAYLIST:{const e=o.querySelector(".ytd-channel-name a");return w(e)}default:return null}})(o)||"Unknown";try{await(async e=>{browser?.storage?.local&&(await(async()=>!0===(await c())[s])()?(await(async e=>await y(browser.storage.local,e))(e),browser?.storage?.session&&await(async e=>await y(browser.storage.session,e))(e)):console.warn("Statistics are disabled, not incrementing hide count."))})(n)}catch(e){console.error("Failed to increment hide count:",e)}o.remove()}},E=async(e,t)=>{for(const t of u){const o=e.matches(t)?[e]:e.querySelectorAll&&e.querySelectorAll(t);for(const e of o)await b(e)}},m=async e=>{const t=await L();if(0!==t.length)for(const o of e){const e=Array.from(o.addedNodes);if(e.length)for(const o of e)if(o.nodeType===Node.ELEMENT_NODE)for(const e of t){const a=n(e),r=o.matches(a)||o.querySelector(a);r&&(await g(r,e),t.splice(t.indexOf(e),1))}}},L=async()=>{const e=await i(),t=Array.from(f.keys()).map(e=>f.get(e).location);return e.filter(e=>!t.includes(e))},g=async(e,t)=>{if(!e?.isConnected)return void console.error("Target for location does not exist or is not connected",t);const o=new MutationObserver((o,n)=>{if(!e.isConnected)return console.log("disconnecting observer for location",t),n.disconnect(),void f.delete(e);(async e=>{for(const t of e){const e=Array.from(t.addedNodes).filter(e=>e.nodeType===Node.ELEMENT_NODE);for(const t of e)await E(t)}})(o)});o.observe(e,{childList:!0,subtree:!0}),f.set(e,{observer:o,location:t}),await(async e=>{for(const t of u)for(const o of e.querySelectorAll(t))await b(o)})(e),console.log("Bound observer for location",t)};(async()=>{await(async()=>{await l(),await(async()=>{const e=await i();if(e.length)for(const t of e){const e=n(t),o=document.querySelector(e);o?await g(o,t):console.warn("No container found for location",t)}else console.warn("No locations to hide are enabled.")})(),await(async()=>{const e=new MutationObserver(m),t=document.body.querySelector("#content");e.observe(t,{childList:!0,subtree:!0})})()})()})()})();