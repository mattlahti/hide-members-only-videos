(()=>{"use strict";const e={HOME:"home",PLAYLIST:"playlist",PLAYER:"player",CHANNEL_INDEX:"channel-index"},t={[e.PLAYER]:"/watch",[e.PLAYLIST]:"/playlist",[e.CHANNEL_INDEX]:"/@",[e.HOME]:"/"},o={[e.PLAYER]:"#related",[e.HOME]:'.ytd-browse[page-subtype="home"] #contents',[e.CHANNEL_INDEX]:'.ytd-browse[page-subtype="channels"] #contents',[e.PLAYLIST]:'.ytd-browse[page-subtype="playlist"] #contents'},n=e=>o[e],a="settings",r="enabledLocations",s="statsEnabled",c=()=>browser.storage.local,i=async()=>(await c().get(a))[a]||null,l=async()=>(await i())[r],d=async()=>{const t=await i();return(t=>{return t&&(t=>{if(!Array.isArray(t))return!1;for(const o of t)if(!Object.values(e).includes(o))return!1;return!0})(t[r])&&(!0===(o=t[s])||!1===o);var o})(t)?t:(await(async()=>{const t={[a]:{[r]:[e.PLAYER,e.PLAYLIST,e.CHANNEL_INDEX,e.HOME],[s]:!0}};return await c().set(t),t})(),await i())},y=()=>browser.storage.local,u=async(e,t)=>{const o=await(async e=>(await y().get(e))[e]||{})(e),n=o[t]||0,a={[e]:{...o,[t]:n+1}};y().set(a)},w=async e=>u("locationHideCounts",e),f=async e=>u("hideCounts",e),m=e=>e?.textContent?.trim(),E=["ytd-rich-item-renderer","yt-lockup-view-model","ytd-playlist-video-renderer"],b=new Map,L=async(o,n)=>{if((e=>Array.from(e.querySelectorAll(".yt-badge-shape__text")).some(e=>e.textContent.toLowerCase().includes("Members only".toLowerCase())))(o)){const a=await(o=>{switch((()=>{for(const[e,o]of Object.entries(t))if(window.location.pathname.startsWith(o))return e;return null})()){case e.PLAYER:case e.HOME:{const e=o.querySelector("yt-content-metadata-view-model span.yt-content-metadata-view-model__metadata-text");return m(e)}case e.CHANNEL_INDEX:{const e=document.getElementById("page-header"),t=e?.querySelector(".dynamicTextViewModelH1 span.yt-core-attributed-string");return m(t)}case e.PLAYLIST:{const e=o.querySelector(".ytd-channel-name a");return m(e)}default:return null}})(o)||"Unknown";try{await(async(e,t)=>{y()&&(await(async()=>!0===(await i())[s])()?await Promise.all([f(e),w(t)]):console.warn("Statistics are disabled, not incrementing hide counts."))})(a,n)}catch(e){console.error("Failed to increment hide count:",e)}o.remove()}},A=async(e,t)=>{for(const o of E){const n=e.matches(o)?[e]:e.querySelectorAll&&e.querySelectorAll(o);for(const e of n)await L(e,t)}},N=async e=>{const t=await h();if(0!==t.length)for(const o of e){const e=Array.from(o.addedNodes);if(e.length)for(const o of e)if(o.nodeType===Node.ELEMENT_NODE)for(const e of t){const a=n(e),r=o.matches(a)||o.querySelector(a);r&&(await p(r,e),t.splice(t.indexOf(e),1))}}},h=async()=>{const e=await l(),t=Array.from(b.keys()).map(e=>b.get(e).location);return e.filter(e=>!t.includes(e))},p=async(e,t)=>{if(!e?.isConnected)return void console.error("Target for location does not exist or is not connected",t);const o=new MutationObserver((o,n)=>{if(!e.isConnected)return console.log("disconnecting observer for location",t),n.disconnect(),void b.delete(e);(async(e,t)=>{for(const o of e){const e=Array.from(o.addedNodes).filter(e=>e.nodeType===Node.ELEMENT_NODE);for(const o of e)await A(o,t)}})(o,t)});o.observe(e,{childList:!0,subtree:!0}),b.set(e,{observer:o,location:t}),await(async(e,t)=>{for(const o of E)for(const n of e.querySelectorAll(o))await L(n,t)})(e,t),console.log("Bound observer for location",t)};(async()=>{await(async()=>{await d(),await(async()=>{const e=await l();if(e.length)for(const t of e){const e=n(t),o=document.querySelector(e);o?await p(o,t):console.warn("No container found for location",t)}else console.warn("No locations to hide are enabled.")})(),await(async()=>{const e=new MutationObserver(N),t=document.body.querySelector("#content");e.observe(t,{childList:!0,subtree:!0})})()})()})()})();