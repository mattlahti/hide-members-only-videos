(()=>{"use strict";const e={HOME:"home",PLAYLIST:"playlist",PLAYER:"player",CHANNEL_INDEX:"channel-index"},t={[e.PLAYER]:"/watch",[e.PLAYLIST]:"/playlist",[e.CHANNEL_INDEX]:"/@",[e.HOME]:"/"},a={[e.PLAYER]:"#related",[e.HOME]:'.ytd-browse[page-subtype="home"] #contents',[e.CHANNEL_INDEX]:'.ytd-browse[page-subtype="channels"] #contents',[e.PLAYLIST]:'.ytd-browse[page-subtype="playlist"] #contents'},o=e=>a[e],n="settings",r="enabledLocations",s="statsEnabled",c=async()=>(await browser.storage.local.get(n))[n]||null,i=async()=>{const t=await c();return(t=>{return t&&(t=>{if(!Array.isArray(t))return!1;for(const a of t)if(!Object.values(e).includes(a))return!1;return!0})(t[r])&&(!0===(a=t[s])||!1===a);var a})(t)?t:(await(async()=>{const t={[n]:{[r]:[e.PLAYER,e.PLAYLIST,e.CHANNEL_INDEX,e.HOME],[s]:!0}};return await(browser.storage?.local?.set(t)),t})(),await c())},l="hideCounts",y=async(e,t)=>{const a=await(async e=>(await e.get(l))[l]||{})(e),o=a[t]||0,n={[l]:{...a,[t]:o+1}};await e.set(n)},d=e=>e?.textContent?.trim();let w=null,u=null;const f=["ytd-rich-item-renderer","yt-lockup-view-model","ytd-playlist-video-renderer"],b=async a=>{if((e=>Array.from(e.querySelectorAll(".yt-badge-shape__text")).some(e=>e.textContent.toLowerCase().includes("Members only".toLowerCase())))(a)){const o=await(a=>{switch((()=>{for(const[e,a]of Object.entries(t))if(window.location.pathname.startsWith(a))return e;return null})()){case e.PLAYER:case e.HOME:{const e=a.querySelector("yt-content-metadata-view-model span.yt-content-metadata-view-model__metadata-text");return d(e)}case e.CHANNEL_INDEX:{const e=document.getElementById("page-header"),t=e?.querySelector(".dynamicTextViewModelH1 span.yt-core-attributed-string");return d(t)}case e.PLAYLIST:{const e=a.querySelector(".ytd-channel-name a");return d(e)}default:return null}})(a)||"Unknown";try{await(async e=>{browser?.storage?.local&&(await(async()=>!0===(await c())[s])()?(await(async e=>await y(browser.storage.local,e))(e),browser?.storage?.session&&await(async e=>await y(browser.storage.session,e))(e)):console.warn("Statistics are disabled, not incrementing hide count."))})(o)}catch(e){console.error("Failed to increment hide count:",e)}a.remove()}},E=async e=>{for(const t of f){const a=e.matches(t)?[e]:e.querySelectorAll&&e.querySelectorAll(t);for(const e of a)await b(e)}},m=async e=>{const t=Array.from(e.addedNodes).filter(e=>e.nodeType===Node.ELEMENT_NODE);for(const e of t)await E(e)},L=async e=>{for(const t of e)await m(t)},N=async e=>{for(const t of e){const e=Array.from(t.addedNodes);if(e.length)for(const t of e){if(t.nodeType!==Node.ELEMENT_NODE)continue;const e=Object.entries(h).filter(([e,t])=>!t);if(!e.length)return void u?.disconnect();for(const[a]of e){const e=o(a),n=t.matches(e)||t.querySelector(e);n&&await g(a,n)}}}},h=Object.fromEntries(Object.values(e).map(e=>[e,!1])),A=()=>Object.values(h).every(e=>!0===e),g=async(e,t)=>{t?(h[e]=!0,A()&&u?.disconnect(),await(async e=>{for(const t of f)for(const a of e.querySelectorAll(t))await b(a)})(t),w.observe(t,{childList:!0,subtree:!0})):console.warn(`No container found for location "${e}"`)},p=async()=>{await i(),await(async()=>{w?w.disconnect():w=new MutationObserver(L);const e=await(async()=>(await c())[r])();if(e.length)for(const t of e){const e=o(t),a=document.querySelector(e);await g(t,a)}else console.warn("No locations to hide are enabled.")})(),await(async()=>{if(A())return;u=new MutationObserver(N);const e=document.body.querySelector("#content");u.observe(e,{childList:!0,subtree:!0})})()};(async()=>{await p()})()})();