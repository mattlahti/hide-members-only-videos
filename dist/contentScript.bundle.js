(()=>{"use strict";const e={HOME:"home",PLAYLIST:"playlist",PLAYER:"player",CHANNEL_INDEX:"channel-index"},t={[e.PLAYER]:"/watch",[e.PLAYLIST]:"/playlist",[e.CHANNEL_INDEX]:"/@",[e.HOME]:"/"},o={[e.PLAYER]:"#related",[e.HOME]:'.ytd-browse[page-subtype="home"] #contents',[e.CHANNEL_INDEX]:'.ytd-browse[page-subtype="channels"] #contents',[e.PLAYLIST]:'.ytd-browse[page-subtype="playlist"] #contents'},n=e=>o[e],a="settings",s="enabledLocations",r="statsEnabled",c=()=>browser.storage.local,i=async()=>(await c().get(a))[a]||null,l=async()=>(await i())[s],d=async()=>{const t=await i();return(t=>{return t&&(t=>{if(!Array.isArray(t))return!1;for(const o of t)if(!Object.values(e).includes(o))return!1;return!0})(t[s])&&(!0===(o=t[r])||!1===o);var o})(t)?t:(await(async()=>{const t={[a]:{[s]:[e.PLAYER,e.PLAYLIST,e.CHANNEL_INDEX,e.HOME],[r]:!0}};return await c().set(t),t})(),await i())},y=()=>browser.storage.local,u=async(e,t)=>{const o=await(async e=>(await y().get(e))[e]||{})(e),n=o[t]||0,a={[e]:{...o,[t]:n+1}};y().set(a)},w=async e=>u("locationHideCounts",e),f=async e=>u("hideCounts",e),b=e=>e?.textContent?.trim(),m=["ytd-rich-item-renderer","yt-lockup-view-model","ytd-playlist-video-renderer"],L=new Map,E=async(o,n)=>{if((e=>Array.from(e.querySelectorAll(".yt-badge-shape__text")).some(e=>e.textContent.toLowerCase().includes("Members only".toLowerCase())))(o)){const a=await(o=>{switch((()=>{for(const[e,o]of Object.entries(t))if(window.location.pathname.startsWith(o))return e;return null})()){case e.PLAYER:case e.HOME:{const e=o.querySelector("yt-content-metadata-view-model span.yt-content-metadata-view-model__metadata-text");return b(e)}case e.CHANNEL_INDEX:{const e=document.getElementById("page-header"),t=e?.querySelector(".dynamicTextViewModelH1 span.yt-core-attributed-string");return b(t)}case e.PLAYLIST:{const e=o.querySelector(".ytd-channel-name a");return b(e)}default:return null}})(o)||"Unknown";try{await(async(e,t)=>{y()&&(await(async()=>!0===(await i())[r])()?await Promise.all([f(e),w(t)]):console.warn("Statistics are disabled, not incrementing hide counts."))})(a,n)}catch(e){console.error("Failed to increment hide count:",e)}o.remove()}},g=async(e,t)=>{for(const o of m){const n=e.matches(o)?[e]:e.querySelectorAll&&e.querySelectorAll(o);for(const e of n)await E(e,t)}},h=async e=>{const t=await p();if(0!==t.length)for(const o of e){const e=Array.from(o.addedNodes);if(e.length)for(const o of e)if(o.nodeType===Node.ELEMENT_NODE)for(const e of t){const a=n(e),s=o.matches(a)||o.querySelector(a);s&&(await A(s,e),t.splice(t.indexOf(e),1))}}},p=async()=>{const e=await l(),t=Array.from(L.keys()).map(e=>L.get(e).location);return e.filter(e=>!t.includes(e))},A=async(e,t)=>{if(!e?.isConnected)return void console.warn("No container found for location",t);const o=new MutationObserver((o,n)=>{if(!e.isConnected)return console.log("disconnecting observer for location",t),n.disconnect(),void L.delete(e);(async(e,t)=>{for(const o of e){const e=Array.from(o.addedNodes).filter(e=>e.nodeType===Node.ELEMENT_NODE);for(const o of e)await g(o,t)}})(o,t)});o.observe(e,{childList:!0,subtree:!0}),L.set(e,{observer:o,location:t}),await(async(e,t)=>{for(const o of m)for(const n of e.querySelectorAll(o))await E(n,t)})(e,t),console.log("Bound observer for location",t)},N=async e=>{const t=n(e),o=document.querySelector(t);await A(o,e)};browser.runtime.onMessage.addListener(async(e,t,o)=>{console.log("message received in content script",e),e.enabledLocations?.length&&await(async e=>{const t=e.map(async e=>(console.log("starting to observe location",e),await N(e),e));await Promise.all(t)})(e.enabledLocations),e.disabledLocations?.length&&(e=>{for(const[t,o]of L)e.includes(o.location)&&(o.observer.disconnect(),L.delete(t),console.log("disconnected observer for location",o.location))})(e.disabledLocations),o({val:"hello from content script"})});(async()=>{await(async()=>{await d(),await(async()=>{const e=await l();if(e.length)for(const t of e)await N(t);else console.warn("No locations to hide are enabled.")})(),await(async()=>{const e=new MutationObserver(h),t=document.body.querySelector("#content");e.observe(t,{childList:!0,subtree:!0})})()})()})()})();